<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pok√©mon Auto Chess Pool Calculator</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
            background: linear-gradient(135deg, #000000 0%, #0f172a 50%, #1e3a5f 100%);
            min-height: 100vh;
        }
        
        /* Navigation Styles */
        .nav-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(56, 189, 248, 0.2);
            padding: 0.75rem 2rem;
        }
        
        .nav-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .nav-brand {
            font-size: 1.25rem;
            font-weight: bold;
            background: linear-gradient(90deg, #38bdf8, #22d3ee);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .nav-dropdown {
            position: relative;
        }
        
        .nav-dropdown-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(56, 189, 248, 0.1);
            border: 1px solid rgba(56, 189, 248, 0.3);
            border-radius: 9999px;
            color: #38bdf8;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .nav-dropdown-btn:hover {
            background: rgba(56, 189, 248, 0.2);
            border-color: rgba(56, 189, 248, 0.5);
        }
        
        .nav-dropdown-menu {
            position: absolute;
            top: calc(100% + 0.5rem);
            right: 0;
            min-width: 220px;
            background: rgba(15, 23, 42, 0.98);
            border: 1px solid rgba(56, 189, 248, 0.3);
            border-radius: 1rem;
            padding: 0.5rem;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }
        
        .nav-dropdown.open .nav-dropdown-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .nav-dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: #94a3b8;
            text-decoration: none;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .nav-dropdown-item:hover {
            background: rgba(56, 189, 248, 0.1);
            color: #38bdf8;
        }
        
        .nav-dropdown-item.active {
            background: rgba(56, 189, 248, 0.15);
            color: #38bdf8;
        }
        
        .nav-dropdown-item-icon {
            width: 20px;
            height: 20px;
            opacity: 0.7;
        }
        
        .nav-dropdown-divider {
            height: 1px;
            background: rgba(56, 189, 248, 0.1);
            margin: 0.5rem 0;
        }
        
        /* Page Container & Transitions */
        .page-container {
            display: flex;
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            min-height: 100vh;
            padding-top: 60px;
        }
        
        .page {
            min-width: 100vw;
            flex-shrink: 0;
            opacity: 1;
            transition: opacity 0.3s;
        }
        
        .page.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        /* Page positions */
        .page-container[data-active-page="calculator"] {
            transform: translateX(0);
        }
        
        .page-container[data-active-page="analytics"] {
            transform: translateX(-100vw);
        }
        
        .page-container[data-active-page="features"] {
            transform: translateX(-200vw);
        }
        
        /* Analytics Page Styles */
        #page-analytics {
            background: linear-gradient(135deg, #000000 0%, #0f172a 50%, #1e3a5f 100%);
            color: white;
            padding: 2rem;
            padding-bottom: 4rem;
            min-height: 100vh;
        }
        
        .analytics-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .analytics-header h1 {
            font-size: 2rem;
            font-weight: bold;
            background: linear-gradient(90deg, #38bdf8, #22d3ee);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 1.5rem;
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .chart-card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.8));
            border: 1px solid rgba(56, 189, 248, 0.2);
            border-radius: 1.5rem;
            padding: 1.5rem;
            padding-bottom: 1rem;
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            min-height: 450px;
        }
        
        .chart-card h3 {
            font-size: 1.25rem;
            font-weight: bold;
            color: #38bdf8;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-shrink: 0;
        }
        
        .chart-container {
            width: 100%;
            flex: 1;
            min-height: 300px;
            position: relative;
        }
        
        /* Chart Tooltip */
        .chart-tooltip {
            position: absolute;
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid rgba(56, 189, 248, 0.5);
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            color: white;
            pointer-events: none;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: opacity 0.15s;
        }
        
        .chart-tooltip.visible {
            opacity: 1;
        }
        
        /* Loading state for charts */
        .chart-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #64748b;
        }
        
        .chart-loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(56, 189, 248, 0.2);
            border-top-color: #38bdf8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Axis and grid styles */
        .axis text {
            fill: #64748b;
            font-size: 11px;
        }
        
        .axis line,
        .axis path {
            stroke: #334155;
        }
        
        .grid line {
            stroke: #1e293b;
            stroke-dasharray: 2, 2;
        }
        
        /* Legend - inside cards */
        .chart-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            padding-top: 0.75rem;
            justify-content: center;
            flex-shrink: 0;
            border-top: 1px solid rgba(56, 189, 248, 0.1);
            margin-top: 0.75rem;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.75rem;
            color: #94a3b8;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            flex-shrink: 0;
        }
        
        /* No data state */
        .no-data {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #64748b;
            text-align: center;
        }
        
        .no-data-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Mobile responsiveness */
        @media (max-width: 1024px) {
            .analytics-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .analytics-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-card {
                min-height: 400px;
            }
            
            .chart-container {
                min-height: 280px;
            }
            
            .nav-brand {
                font-size: 1rem;
            }
            
            #page-analytics {
                padding: 1rem;
                padding-bottom: 3rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav-container">
        <div class="nav-content">
            <div class="nav-brand">PAC Analytics</div>
            <div class="nav-dropdown" id="navDropdown">
                <button class="nav-dropdown-btn" onclick="toggleNavDropdown()">
                    <span id="currentPageLabel">Calculator</span>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"/>
                    </svg>
                </button>
                <div class="nav-dropdown-menu">
                    <div class="nav-dropdown-item active" data-page="calculator" onclick="navigateTo('calculator')">
                        <svg class="nav-dropdown-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect width="16" height="20" x="4" y="2" rx="2"/>
                            <line x1="8" x2="16" y1="6" y2="6"/>
                        </svg>
                        <span>Calculator</span>
                    </div>
                    <div class="nav-dropdown-item" data-page="analytics" onclick="navigateTo('analytics')">
                        <svg class="nav-dropdown-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 3v18h18"/>
                            <path d="M18 17V9"/>
                            <path d="M13 17V5"/>
                            <path d="M8 17v-3"/>
                        </svg>
                        <span>Analytics Dashboard</span>
                    </div>
                    <div class="nav-dropdown-divider"></div>
                    <div class="nav-dropdown-item" data-page="features" onclick="navigateTo('features')">
                        <svg class="nav-dropdown-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1"/>
                        </svg>
                        <span>More Features</span>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- Page Container -->
    <div class="page-container" id="pageContainer" data-active-page="calculator">
        <!-- Calculator Page -->
        <div class="page" id="page-calculator">
            <div id="root"></div>
        </div>
        
        <!-- Analytics Page -->
        <div class="page" id="page-analytics">
            <div id="analytics-root">
                <div class="analytics-header">
                    <h1>üìä Analytics Dashboard</h1>
                    <p style="color: #64748b;">Real-time probability analysis and decision support</p>
                </div>
                <div class="analytics-grid" id="analyticsGrid">
                    <!-- Charts will be mounted here by analytics.js -->
                    <div class="chart-card">
                        <h3>üìà Probability Curves</h3>
                        <div class="chart-container" id="chart-probability-curves">
                            <div class="chart-loading">
                                <div class="chart-loading-spinner"></div>
                            </div>
                        </div>
                    </div>
                    <div class="chart-card">
                        <h3>üí∞ Gold ROI Analysis</h3>
                        <div class="chart-container" id="chart-gold-roi">
                            <div class="chart-loading">
                                <div class="chart-loading-spinner"></div>
                            </div>
                        </div>
                    </div>
                    <div class="chart-card">
                        <h3>üå™Ô∏è Sensitivity Analysis</h3>
                        <div class="chart-container" id="chart-tornado">
                            <div class="chart-loading">
                                <div class="chart-loading-spinner"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Future Features Page -->
        <div class="page" id="page-features">
            <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 80vh; color: white; text-align: center; padding: 2rem;">
                <div style="font-size: 4rem; margin-bottom: 1rem;">üöÄ</div>
                <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">More Features Coming Soon</h1>
                <p style="color: #64748b; max-width: 400px;">
                    This space is reserved for future enhancements. Stay tuned!
                </p>
            </div>
        </div>
    </div>
    
    <!-- Navigation Scripts -->
    <script>
        // Navigation state
        let currentPage = 'calculator';
        let dropdownOpen = false;
        
        function toggleNavDropdown() {
            const dropdown = document.getElementById('navDropdown');
            dropdownOpen = !dropdownOpen;
            dropdown.classList.toggle('open', dropdownOpen);
        }
        
        function navigateTo(page) {
            if (page === currentPage) {
                toggleNavDropdown();
                return;
            }
            
            currentPage = page;
            
            // Update page container
            const container = document.getElementById('pageContainer');
            container.setAttribute('data-active-page', page);
            
            // Update nav label
            const labels = { calculator: 'Calculator', analytics: 'Analytics Dashboard', features: 'More Features' };
            document.getElementById('currentPageLabel').textContent = labels[page] || page;
            
            // Update active state in menu
            document.querySelectorAll('.nav-dropdown-item[data-page]').forEach(item => {
                item.classList.toggle('active', item.dataset.page === page);
            });
            
            // Close dropdown
            dropdownOpen = false;
            document.getElementById('navDropdown').classList.remove('open');
            
            // Trigger analytics render if navigating to analytics (after transition completes)
            if (page === 'analytics' && window.renderAnalytics) {
                // Wait for CSS transition (500ms) plus a bit extra
                setTimeout(() => window.renderAnalytics(), 600);
            }
        }
        
        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            const dropdown = document.getElementById('navDropdown');
            if (!dropdown.contains(e.target) && dropdownOpen) {
                dropdownOpen = false;
                dropdown.classList.remove('open');
            }
        });
    </script>
    
    <script type="text/babel">
        const { useState, useMemo, useEffect, useCallback } = React;

        // Lucide icons as inline SVG components
        const Calculator = ({ className }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect width="16" height="20" x="4" y="2" rx="2"/>
                <line x1="8" x2="16" y1="6" y2="6"/>
                <line x1="16" x2="16" y1="14" y2="14"/>
                <path d="M16 10h.01"/>
                <path d="M12 10h.01"/>
                <path d="M8 10h.01"/>
                <path d="M12 14h.01"/>
                <path d="M8 14h.01"/>
                <path d="M12 18h.01"/>
                <path d="M8 18h.01"/>
            </svg>
        );

        const TrendingUp = ({ className }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/>
                <polyline points="16 7 22 7 22 13"/>
            </svg>
        );

        const ChevronDown = ({ className }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="6 9 12 15 18 9"/>
            </svg>
        );

        const PokemonAutoChessCalculator = () => {
            // Base game data
            const baseGamePools = {
                common: { twoStar: 2, threeStar: 19 },
                uncommon: { twoStar: 5, threeStar: 15 },
                rare: { twoStar: 3, threeStar: 15 },
                epic: { twoStar: 1, threeStar: 16 },
                ultra: { twoStar: 0, threeStar: 13 }
            };

            const poolCopies = {
                common: { twoStar: 18, threeStar: 27 },
                uncommon: { twoStar: 13, threeStar: 22 },
                rare: { twoStar: 9, threeStar: 18 },
                epic: { twoStar: 7, threeStar: 14 },
                ultra: { twoStar: 5, threeStar: 10 }
            };

            const shopOdds = {
                1: { common: 100, uncommon: 0, rare: 0, epic: 0, ultra: 0 },
                2: { common: 100, uncommon: 0, rare: 0, epic: 0, ultra: 0 },
                3: { common: 70, uncommon: 30, rare: 0, epic: 0, ultra: 0 },
                4: { common: 50, uncommon: 40, rare: 10, epic: 0, ultra: 0 },
                5: { common: 36, uncommon: 42, rare: 20, epic: 2, ultra: 0 },
                6: { common: 25, uncommon: 40, rare: 30, epic: 5, ultra: 0 },
                7: { common: 16, uncommon: 33, rare: 35, epic: 15, ultra: 1 },
                8: { common: 11, uncommon: 27, rare: 35, epic: 22, ultra: 5 },
                9: { common: 5, uncommon: 20, rare: 35, epic: 30, ultra: 10 }
            };

            // Base Wild counts
            const baseWildCounts = {
                common: { twoStar: 2, threeStar: 0 },
                uncommon: { twoStar: 4, threeStar: 0 },
                rare: { twoStar: 4, threeStar: 0 },
                epic: { twoStar: 2, threeStar: 1 },
                ultra: { twoStar: 0, threeStar: 1 }
            };

            // State
            const [level, setLevel] = useState(7);
            const [targetRarity, setTargetRarity] = useState('rare');
            const [targetEvo, setTargetEvo] = useState('threeStar');
            const [refreshes, setRefreshes] = useState(10);
            const [copiesTaken, setCopiesTaken] = useState(0);
            const [benchUnits, setBenchUnits] = useState(0);
            const [evolutionGoal, setEvolutionGoal] = useState('firstEvo');
            const [copiesOwned, setCopiesOwned] = useState(0);
            const [dittoEnabled, setDittoEnabled] = useState(false);

            // Add Picks (formerly Regional Additions) - simplified to single input
            const [round5Enabled, setRound5Enabled] = useState(false);
            const [round5AddPicks, setRound5AddPicks] = useState(8);

            const [round8Enabled, setRound8Enabled] = useState(false);
            const [round8AddPicks, setRound8AddPicks] = useState(8);

            const [round11Enabled, setRound11Enabled] = useState(false);
            const [round11AddPicks, setRound11AddPicks] = useState(8);

            // Portal regionals
            const [portalRegionals, setPortalRegionals] = useState({
                common: { twoStar: 0, threeStar: 0 },
                uncommon: { twoStar: 0, threeStar: 0 },
                rare: { twoStar: 0, threeStar: 0 },
                epic: { twoStar: 0, threeStar: 0 },
                ultra: { twoStar: 0, threeStar: 0 }
            });

            // Wild mechanics state
            const [wildExpanded, setWildExpanded] = useState(false);
            const [targetIsWild, setTargetIsWild] = useState(false);
            const [pveRoundEnabled, setPveRoundEnabled] = useState(false);
            const [wildUnitsOwned, setWildUnitsOwned] = useState(0);
            const [wildUnitsTaken, setWildUnitsTaken] = useState(0); // Wild units on opponent boards (same rarity/evo)
            const [wildUnitsBenched, setWildUnitsBenched] = useState(0); // Wild units on your bench (same rarity/evo)
            const [wildAddPicks, setWildAddPicks] = useState({
                uncommon: 0,
                rare: 0,
                epic: 0
            });
            const [wildRegionals, setWildRegionals] = useState({
                common: { twoStar: 0, threeStar: 0 },
                uncommon: { twoStar: 0, threeStar: 0 },
                rare: { twoStar: 0, threeStar: 0 },
                epic: { twoStar: 0, threeStar: 0 },
                ultra: { twoStar: 0, threeStar: 0 }
            });

            // Clear all inputs
            const clearInputs = () => {
                setCopiesTaken(0);
                setBenchUnits(0);
                setCopiesOwned(0);
                setDittoEnabled(false);
                setRound5Enabled(false);
                setRound5AddPicks(8);
                setRound8Enabled(false);
                setRound8AddPicks(8);
                setRound11Enabled(false);
                setRound11AddPicks(8);
                setPortalRegionals({
                    common: { twoStar: 0, threeStar: 0 },
                    uncommon: { twoStar: 0, threeStar: 0 },
                    rare: { twoStar: 0, threeStar: 0 },
                    epic: { twoStar: 0, threeStar: 0 },
                    ultra: { twoStar: 0, threeStar: 0 }
                });
                setTargetIsWild(false);
                setPveRoundEnabled(false);
                setWildUnitsOwned(0);
                setWildUnitsTaken(0);
                setWildUnitsBenched(0);
                setWildAddPicks({ uncommon: 0, rare: 0, epic: 0 });
                setWildRegionals({
                    common: { twoStar: 0, threeStar: 0 },
                    uncommon: { twoStar: 0, threeStar: 0 },
                    rare: { twoStar: 0, threeStar: 0 },
                    epic: { twoStar: 0, threeStar: 0 },
                    ultra: { twoStar: 0, threeStar: 0 }
                });
            };

            // Calculate total Wild counts per rarity
            const totalWildCounts = useMemo(() => {
                const counts = {};
                
                Object.keys(baseWildCounts).forEach(rarity => {
                    let twoStarCount = baseWildCounts[rarity].twoStar;
                    let threeStarCount = baseWildCounts[rarity].threeStar;

                    // Add pick wilds (always 2‚òÖ-max)
                    if (rarity === 'uncommon' && round5Enabled) {
                        twoStarCount += wildAddPicks.uncommon;
                    }
                    if (rarity === 'rare' && round8Enabled) {
                        twoStarCount += wildAddPicks.rare;
                    }
                    if (rarity === 'epic' && round11Enabled) {
                        twoStarCount += wildAddPicks.epic;
                    }

                    // Regional wilds
                    twoStarCount += wildRegionals[rarity].twoStar;
                    threeStarCount += wildRegionals[rarity].threeStar;

                    counts[rarity] = {
                        twoStar: twoStarCount,
                        threeStar: threeStarCount,
                        total: twoStarCount + threeStarCount
                    };
                });

                return counts;
            }, [round5Enabled, round8Enabled, round11Enabled, wildAddPicks, wildRegionals]);

            // Calculate total pool for each rarity
            const calculateTotalPool = useMemo(() => {
                const pools = {};
                
                Object.keys(baseGamePools).forEach(rarity => {
                    let twoStarSpecies = baseGamePools[rarity].twoStar;
                    let threeStarSpecies = baseGamePools[rarity].threeStar;

                    // Add round-based add picks (always 2‚òÖ-max)
                    if (rarity === 'uncommon' && round5Enabled) {
                        twoStarSpecies += round5AddPicks;
                    }
                    if (rarity === 'rare' && round8Enabled) {
                        twoStarSpecies += round8AddPicks;
                    }
                    if (rarity === 'epic' && round11Enabled) {
                        twoStarSpecies += round11AddPicks;
                    }

                    // Add portal regionals
                    twoStarSpecies += portalRegionals[rarity].twoStar;
                    threeStarSpecies += portalRegionals[rarity].threeStar;

                    const twoStarCopies = twoStarSpecies * poolCopies[rarity].twoStar;
                    const threeStarCopies = threeStarSpecies * poolCopies[rarity].threeStar;

                    pools[rarity] = {
                        twoStarTotal: twoStarCopies,
                        threeStarTotal: threeStarCopies,
                        total: twoStarCopies + threeStarCopies,
                        twoStarSpecies,
                        threeStarSpecies
                    };
                });

                return pools;
            }, [round5Enabled, round5AddPicks,
                round8Enabled, round8AddPicks,
                round11Enabled, round11AddPicks,
                portalRegionals]);

            // Calculate probabilities
            const probabilities = useMemo(() => {
                const rarityOdds = shopOdds[level];
                const pool = calculateTotalPool[targetRarity];
                
                const rarityChance = rarityOdds[targetRarity] / 100;
                
                const maxTargetCopies = targetEvo === 'twoStar' ? 
                    poolCopies[targetRarity].twoStar : 
                    poolCopies[targetRarity].threeStar;
                
                const targetCopies = Math.max(0, maxTargetCopies - copiesTaken);
                
                const relevantPoolBeforeBench = targetEvo === 'twoStar' ? 
                    pool.twoStarTotal : pool.threeStarTotal;
                const otherPoolPortion = targetEvo === 'twoStar' ? 
                    pool.threeStarTotal : pool.twoStarTotal;
                
                const relevantPoolAfterBench = Math.max(0, relevantPoolBeforeBench - benchUnits);
                const totalPoolSize = relevantPoolAfterBench + otherPoolPortion;
                
                // Check if Wild units exist for target rarity+evo
                const wildCountsForRarity = totalWildCounts[targetRarity];
                const wildUnitsExist = targetEvo === 'twoStar' ? 
                    wildCountsForRarity.twoStar > 0 : 
                    wildCountsForRarity.threeStar > 0;
                
                // Calculate Wild pool size (for Path A denominator)
                const totalWildCopiesBeforeReduction = targetEvo === 'twoStar' ?
                    wildCountsForRarity.twoStar * poolCopies[targetRarity].twoStar :
                    wildCountsForRarity.threeStar * poolCopies[targetRarity].threeStar;
                
                const totalWildCopies = Math.max(0, totalWildCopiesBeforeReduction - wildUnitsTaken - wildUnitsBenched);
                
                // Wild boost calculation - applies during PVE regardless of target type
                const wildBoost = pveRoundEnabled ? 
                    (0.05 + (wildUnitsOwned * 0.01)) : 0;
                
                // Base probability calculation
                let perSlotProbTarget = 0;
                let wildTargetImpossible = false;
                
                if (targetIsWild && !wildUnitsExist) {
                    // Target is Wild but no Wild units exist for this rarity+evo combo
                    perSlotProbTarget = 0;
                    wildTargetImpossible = true;
                } else if (targetCopies > 0 && totalPoolSize > 0) {
                    const baseProb = rarityChance * (targetCopies / totalPoolSize);
                    
                    if (targetIsWild && pveRoundEnabled && wildUnitsExist && totalWildCopies > 0) {
                        // Wild target: two paths
                        // Path A: Wild boost triggers ‚Üí correct rarity ‚Üí specific Wild
                        const pathA = wildBoost * rarityChance * (targetCopies / totalWildCopies);
                        
                        // Path B: Wild boost misses ‚Üí normal shop
                        const pathB = (1 - wildBoost) * baseProb;
                        
                        perSlotProbTarget = pathA + pathB;
                    } else if (targetIsWild && !pveRoundEnabled && wildUnitsExist) {
                        // Wild target but PVE not active - normal calculation
                        perSlotProbTarget = baseProb;
                    } else if (!targetIsWild && pveRoundEnabled) {
                        // Non-Wild target during PVE: penalty
                        perSlotProbTarget = baseProb * (1 - wildBoost);
                    } else {
                        // Normal calculation
                        perSlotProbTarget = baseProb;
                    }
                }
                
                const dittoProb = 0.005;
                const perSlotProbWithDitto = perSlotProbTarget + dittoProb;
                
                const perRefreshProbNoDitto = 1 - Math.pow(1 - perSlotProbTarget, 6);
                const perRefreshProbWithDitto = 1 - Math.pow(1 - perSlotProbWithDitto, 6);
                const perRefreshProb = dittoEnabled ? perRefreshProbWithDitto : perRefreshProbNoDitto;
                
                const overNRefreshes = 1 - Math.pow(1 - perRefreshProb, refreshes);
                
                const expectedFor50 = perRefreshProb > 0 ? Math.log(0.5) / Math.log(1 - perRefreshProb) : Infinity;
                const expectedFor75 = perRefreshProb > 0 ? Math.log(0.25) / Math.log(1 - perRefreshProb) : Infinity;
                const expectedFor90 = perRefreshProb > 0 ? Math.log(0.1) / Math.log(1 - perRefreshProb) : Infinity;

                const totalCopiesNeeded = evolutionGoal === 'firstEvo' ? 3 : 9;
                const copiesStillNeeded = Math.max(0, totalCopiesNeeded - copiesOwned);
                const expectedCopiesPerRefresh = 6 * (dittoEnabled ? perSlotProbWithDitto : perSlotProbTarget);
                
                const approxRefreshesFor50Copies = expectedCopiesPerRefresh > 0 && copiesStillNeeded > 0 ? 
                    copiesStillNeeded / expectedCopiesPerRefresh : Infinity;
                const approxRefreshesFor75Copies = expectedCopiesPerRefresh > 0 && copiesStillNeeded > 0 ?
                    copiesStillNeeded / expectedCopiesPerRefresh * 1.4 : Infinity;
                const approxRefreshesFor90Copies = expectedCopiesPerRefresh > 0 && copiesStillNeeded > 0 ?
                    copiesStillNeeded / expectedCopiesPerRefresh * 1.8 : Infinity;

                let levelUpPreview = null;
                if (level < 9) {
                    const nextLevelOdds = shopOdds[level + 1];
                    const nextRarityChance = nextLevelOdds[targetRarity] / 100;
                    let nextPerSlotProb = 0;
                    
                    if (!wildTargetImpossible && targetCopies > 0 && totalPoolSize > 0) {
                        const nextBaseProb = nextRarityChance * (targetCopies / totalPoolSize);
                        
                        if (targetIsWild && pveRoundEnabled && wildUnitsExist && totalWildCopies > 0) {
                            const pathA = wildBoost * nextRarityChance * (targetCopies / totalWildCopies);
                            const pathB = (1 - wildBoost) * nextBaseProb;
                            nextPerSlotProb = pathA + pathB;
                        } else if (targetIsWild && !pveRoundEnabled && wildUnitsExist) {
                            nextPerSlotProb = nextBaseProb;
                        } else if (!targetIsWild && pveRoundEnabled) {
                            nextPerSlotProb = nextBaseProb * (1 - wildBoost);
                        } else {
                            nextPerSlotProb = nextBaseProb;
                        }
                    }
                    
                    const nextPerSlotProbWithDitto = nextPerSlotProb + dittoProb;
                    const nextPerRefreshProb = dittoEnabled ? 
                        1 - Math.pow(1 - nextPerSlotProbWithDitto, 6) :
                        1 - Math.pow(1 - nextPerSlotProb, 6);
                    
                    levelUpPreview = {
                        nextLevel: level + 1,
                        perSlot: nextPerSlotProb * 100,
                        perRefresh: nextPerRefreshProb * 100,
                        improvementPercent: perRefreshProb > 0 ? 
                            ((nextPerRefreshProb - perRefreshProb) / perRefreshProb * 100) : 0
                    };
                }

                return {
                    perSlot: perSlotProbTarget * 100,
                    perSlotWithDitto: perSlotProbWithDitto * 100,
                    perRefresh: perRefreshProbNoDitto * 100,
                    perRefreshWithDitto: perRefreshProbWithDitto * 100,
                    overNRefreshes: overNRefreshes * 100,
                    expectedFor50: Math.ceil(expectedFor50),
                    expectedFor75: Math.ceil(expectedFor75),
                    expectedFor90: Math.ceil(expectedFor90),
                    goldFor50: Math.ceil(approxRefreshesFor50Copies),
                    goldFor75: Math.ceil(approxRefreshesFor75Copies),
                    goldFor90: Math.ceil(approxRefreshesFor90Copies),
                    totalCopiesNeeded,
                    copiesStillNeeded,
                    targetCopies,
                    maxTargetCopies,
                    totalPoolSize,
                    relevantPoolBeforeBench,
                    rarityChance: rarityChance * 100,
                    levelUpPreview,
                    dittoProb: dittoProb * 100,
                    wildBoost: wildBoost * 100,
                    wildTargetImpossible,
                    wildUnitsExist
                };
            }, [level, targetRarity, targetEvo, refreshes, calculateTotalPool, copiesTaken, benchUnits, 
                evolutionGoal, copiesOwned, dittoEnabled, targetIsWild, pveRoundEnabled, wildUnitsOwned, 
                wildUnitsTaken, wildUnitsBenched, totalWildCounts]);

            const updatePortalRegional = (rarity, evo, value) => {
                setPortalRegionals(prev => ({
                    ...prev,
                    [rarity]: {
                        ...prev[rarity],
                        [evo]: Math.max(0, parseInt(value) || 0)
                    }
                }));
            };

            const updateWildRegional = (rarity, evo, value) => {
                setWildRegionals(prev => ({
                    ...prev,
                    [rarity]: {
                        ...prev[rarity],
                        [evo]: Math.max(0, parseInt(value) || 0)
                    }
                }));
            };

            const rarityColors = {
                common: 'text-gray-400',
                uncommon: 'text-green-400',
                rare: 'text-cyan-400',
                epic: 'text-purple-400',
                ultra: 'text-red-400'
            };

            // Expose state to window for external analytics (debounced)
            useEffect(() => {
                const timeoutId = setTimeout(() => {
                    window.calculatorState = {
                        // Core settings
                        level,
                        targetRarity,
                        targetEvo,
                        refreshes,
                        evolutionGoal,
                        copiesOwned,
                        copiesTaken,
                        benchUnits,
                        dittoEnabled,
                        
                        // Add picks
                        round5Enabled,
                        round5AddPicks,
                        round8Enabled,
                        round8AddPicks,
                        round11Enabled,
                        round11AddPicks,
                        
                        // Portal regionals
                        portalRegionals,
                        
                        // Wild mechanics
                        targetIsWild,
                        pveRoundEnabled,
                        wildUnitsOwned,
                        wildUnitsTaken,
                        wildUnitsBenched,
                        wildAddPicks,
                        wildRegionals,
                        
                        // Calculated values
                        probabilities,
                        calculateTotalPool,
                        totalWildCounts,
                        
                        // Static game data
                        baseGamePools,
                        poolCopies,
                        shopOdds,
                        baseWildCounts
                    };
                    
                    // Dispatch event for external listeners
                    window.dispatchEvent(new CustomEvent('calculatorStateChange', {
                        detail: window.calculatorState
                    }));
                }, 50); // 50ms debounce
                
                return () => clearTimeout(timeoutId);
            }, [
                level, targetRarity, targetEvo, refreshes, evolutionGoal, copiesOwned,
                copiesTaken, benchUnits, dittoEnabled, round5Enabled, round5AddPicks,
                round8Enabled, round8AddPicks, round11Enabled, round11AddPicks,
                portalRegionals, targetIsWild, pveRoundEnabled, wildUnitsOwned,
                wildUnitsTaken, wildUnitsBenched, wildAddPicks, wildRegionals,
                probabilities, calculateTotalPool, totalWildCounts
            ]);

            return (
                <div className="min-h-screen bg-gradient-to-br from-black via-slate-900 to-blue-950 text-white p-8">
                    <div className="max-w-7xl mx-auto">
                        {/* Header */}
                        <div className="text-center mb-12">
                            <div className="inline-flex items-center gap-3 px-6 py-3 bg-gradient-to-r from-blue-600/20 to-cyan-600/20 rounded-full border border-blue-500/30 backdrop-blur-sm mb-4">
                                <Calculator className="w-6 h-6 text-cyan-400" />
                                <h1 className="text-3xl font-bold bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent">
                                    Pok√©mon Auto Chess Pool Calculator
                                </h1>
                            </div>
                            <p className="text-gray-400 text-sm">Real-time odds calculation for competitive play</p>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            {/* Left Column - Configuration */}
                            <div className="lg:col-span-2 space-y-6">
                                {/* Target Configuration Card */}
                                <div className="bg-gradient-to-br from-slate-800/80 to-slate-900/80 backdrop-blur-xl rounded-3xl p-8 border border-slate-700/50 shadow-2xl">
                                    <div className="flex justify-between items-center mb-6">
                                        <div className="flex items-center gap-3">
                                            <div className="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center">
                                                <TrendingUp className="w-5 h-5 text-white" />
                                            </div>
                                            <h2 className="text-2xl font-bold">Target Configuration</h2>
                                        </div>
                                        <button
                                            onClick={clearInputs}
                                            className="px-4 py-2 bg-gradient-to-r from-red-600 to-red-700 hover:from-red-500 hover:to-red-600 rounded-full text-sm font-semibold transition-all duration-200 shadow-lg hover:shadow-red-500/50"
                                        >
                                            Clear All
                                        </button>
                                    </div>
                                    
                                    <div className="grid grid-cols-2 gap-4 mb-6">
                                        <div>
                                            <label className="block text-sm font-semibold mb-2 text-gray-300">Your Level</label>
                                            <select 
                                                value={level} 
                                                onChange={(e) => setLevel(parseInt(e.target.value))}
                                                className="w-full bg-slate-900/50 border border-slate-600/50 rounded-2xl px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                            >
                                                {[1,2,3,4,5,6,7,8,9].map(l => (
                                                    <option key={l} value={l}>Level {l}</option>
                                                ))}
                                            </select>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-semibold mb-2 text-gray-300">Refreshes to Check</label>
                                            <input 
                                                type="number" 
                                                value={refreshes}
                                                onChange={(e) => setRefreshes(Math.max(1, parseInt(e.target.value) || 1))}
                                                className="w-full bg-slate-900/50 border border-slate-600/50 rounded-2xl px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                                min="1"
                                            />
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-2 gap-4 mb-6">
                                        <div>
                                            <label className="block text-sm font-semibold mb-2 text-gray-300">Target Rarity</label>
                                            <select 
                                                value={targetRarity}
                                                onChange={(e) => setTargetRarity(e.target.value)}
                                                className="w-full bg-slate-900/50 border border-slate-600/50 rounded-2xl px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                            >
                                                <option value="common">Common</option>
                                                <option value="uncommon">Uncommon</option>
                                                <option value="rare">Rare</option>
                                                <option value="epic">Epic</option>
                                                <option value="ultra">Ultra</option>
                                            </select>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-semibold mb-2 text-gray-300">Max Evolution</label>
                                            <select 
                                                value={targetEvo}
                                                onChange={(e) => setTargetEvo(e.target.value)}
                                                className="w-full bg-slate-900/50 border border-slate-600/50 rounded-2xl px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                            >
                                                <option value="twoStar">2‚òÖ Max</option>
                                                <option value="threeStar">3‚òÖ Max</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div className="mb-6">
                                        <label className="block text-sm font-semibold mb-2 text-gray-300">Evolution Goal</label>
                                        <select
                                            value={evolutionGoal}
                                            onChange={(e) => setEvolutionGoal(e.target.value)}
                                            className="w-full bg-slate-900/50 border border-slate-600/50 rounded-2xl px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                        >
                                            <option value="firstEvo">First Evolution (3 copies)</option>
                                            {targetEvo === 'threeStar' && (
                                                <option value="maxEvo">Max Evolution (9 copies)</option>
                                            )}
                                        </select>
                                    </div>

                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-semibold mb-2 text-gray-300">Copies You Have</label>
                                            <input 
                                                type="number"
                                                value={copiesOwned}
                                                onChange={(e) => setCopiesOwned(Math.max(0, Math.min(probabilities.totalCopiesNeeded, parseInt(e.target.value) || 0)))}
                                                className="w-full bg-slate-900/50 border border-slate-600/50 rounded-2xl px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                                min="0"
                                                max={probabilities.totalCopiesNeeded}
                                            />
                                            <div className="text-xs text-cyan-400 mt-2 font-medium">
                                                Need {probabilities.copiesStillNeeded} more
                                            </div>
                                        </div>

                                        <div className="flex items-center">
                                            <label className="flex items-center gap-3 cursor-pointer px-4 py-3 bg-slate-900/30 rounded-2xl border border-slate-600/30 hover:border-cyan-500/50 transition-all w-full">
                                                <input 
                                                    type="checkbox"
                                                    checked={dittoEnabled}
                                                    onChange={(e) => setDittoEnabled(e.target.checked)}
                                                    className="w-5 h-5 accent-cyan-500"
                                                />
                                                <div>
                                                    <span className="font-semibold text-cyan-400">Include Ditto</span>
                                                    <div className="text-xs text-gray-400">0.5% per slot</div>
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                {/* Scouting & Bench Row */}
                                <div className="grid grid-cols-2 gap-6">
                                    {/* Scouting Card */}
                                    <div className="bg-gradient-to-br from-slate-800/80 to-slate-900/80 backdrop-blur-xl rounded-3xl p-6 border border-slate-700/50 shadow-2xl">
                                        <div className="flex items-center gap-3 mb-4">
                                            <div className="w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-lg">
                                                üëÅÔ∏è
                                            </div>
                                            <h2 className="text-xl font-bold">Scouting</h2>
                                        </div>
                                        <p className="text-sm text-gray-400 mb-4">
                                            Your specific target on opponent boards
                                            {targetIsWild && <span className="block text-amber-400 mt-1">(Wild scouting in Wild Mechanics below)</span>}
                                        </p>
                                        <div>
                                            <input 
                                                type="number"
                                                value={copiesTaken}
                                                onChange={(e) => setCopiesTaken(Math.max(0, parseInt(e.target.value) || 0))}
                                                className="w-full bg-slate-900/50 border border-slate-600/50 rounded-2xl px-4 py-3 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                                                min="0"
                                                max={probabilities.maxTargetCopies}
                                            />
                                            <div className="flex justify-between items-center mt-2">
                                                <div className={`text-xs font-semibold ${
                                                    probabilities.targetCopies === 0 ? 'text-red-400' :
                                                    probabilities.targetCopies <= 3 ? 'text-yellow-400' :
                                                    'text-cyan-400'
                                                }`}>
                                                    {probabilities.targetCopies === 0 ? '‚ùå Pool depleted!' :
                                                     probabilities.targetCopies <= 3 ? `‚ö†Ô∏è Only ${probabilities.targetCopies} left!` :
                                                     `‚úì ${probabilities.targetCopies} remaining`}
                                                </div>
                                                <div className="text-xs text-gray-500">
                                                    Max: {probabilities.maxTargetCopies}
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Bench Card */}
                                    <div className="bg-gradient-to-br from-slate-800/80 to-slate-900/80 backdrop-blur-xl rounded-3xl p-6 border border-slate-700/50 shadow-2xl">
                                        <div className="flex items-center gap-3 mb-4">
                                            <div className="w-8 h-8 rounded-full bg-gradient-to-br from-orange-500 to-yellow-500 flex items-center justify-center text-lg">
                                                üéØ
                                            </div>
                                            <h2 className="text-xl font-bold">Your Bench</h2>
                                        </div>
                                        <p className="text-sm text-gray-400 mb-4">
                                            Same rarity/evo as target (all units)
                                            {targetIsWild && <span className="block text-amber-400 mt-1">(Wild bench tracking in Wild Mechanics below)</span>}
                                        </p>
                                        <div>
                                            <input 
                                                type="number"
                                                value={benchUnits}
                                                onChange={(e) => setBenchUnits(Math.max(0, parseInt(e.target.value) || 0))}
                                                className="w-full bg-slate-900/50 border border-slate-600/50 rounded-2xl px-4 py-3 focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all"
                                                min="0"
                                            />
                                            <div className="text-xs text-gray-400 mt-2">
                                                Reduces total pool size
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Add Picks (formerly Regional Additions) */}
                                <div className="bg-gradient-to-br from-slate-800/80 to-slate-900/80 backdrop-blur-xl rounded-3xl p-8 border border-slate-700/50 shadow-2xl">
                                    <div className="flex items-center gap-3 mb-4">
                                        <div className="w-10 h-10 rounded-full bg-gradient-to-br from-green-500 to-emerald-500 flex items-center justify-center text-xl">
                                            üåç
                                        </div>
                                        <h2 className="text-2xl font-bold">Add Picks</h2>
                                    </div>
                                    <div className="mb-6 p-3 bg-amber-900/30 border border-amber-500/50 rounded-xl">
                                        <div className="text-amber-400 font-semibold text-sm flex items-center gap-2">
                                            <span>‚ö†Ô∏è</span>
                                            <span>DO NOT PUT WILD UNITS HERE - Use Wild Mechanics section below</span>
                                        </div>
                                    </div>
                                    
                                    {/* Round 5 */}
                                    <div className="mb-4 pb-4 border-b border-slate-700/50">
                                        <label className="flex items-center gap-3 mb-3 cursor-pointer group">
                                            <input 
                                                type="checkbox" 
                                                checked={round5Enabled}
                                                onChange={(e) => setRound5Enabled(e.target.checked)}
                                                className="w-5 h-5 accent-green-500"
                                            />
                                            <span className="font-semibold text-lg group-hover:text-green-400 transition-colors">Round 5+ (Uncommon Add Picks)</span>
                                        </label>
                                        {round5Enabled && (
                                            <div className="ml-8">
                                                <label className="block text-sm text-gray-400 mb-1">Add picks (2‚òÖ-max)</label>
                                                <input 
                                                    type="number"
                                                    value={round5AddPicks}
                                                    onChange={(e) => setRound5AddPicks(Math.max(0, parseInt(e.target.value) || 0))}
                                                    className="w-full bg-slate-900/50 border border-slate-600/50 rounded-xl px-3 py-2 text-sm focus:ring-2 focus:ring-green-500 transition-all"
                                                    min="0"
                                                />
                                            </div>
                                        )}
                                    </div>

                                    {/* Round 8 */}
                                    <div className="mb-4 pb-4 border-b border-slate-700/50">
                                        <label className="flex items-center gap-3 mb-3 cursor-pointer group">
                                            <input 
                                                type="checkbox" 
                                                checked={round8Enabled}
                                                onChange={(e) => setRound8Enabled(e.target.checked)}
                                                className="w-5 h-5 accent-cyan-500"
                                            />
                                            <span className="font-semibold text-lg group-hover:text-cyan-400 transition-colors">Round 8+ (Rare Add Picks)</span>
                                        </label>
                                        {round8Enabled && (
                                            <div className="ml-8">
                                                <label className="block text-sm text-gray-400 mb-1">Add picks (2‚òÖ-max)</label>
                                                <input 
                                                    type="number"
                                                    value={round8AddPicks}
                                                    onChange={(e) => setRound8AddPicks(Math.max(0, parseInt(e.target.value) || 0))}
                                                    className="w-full bg-slate-900/50 border border-slate-600/50 rounded-xl px-3 py-2 text-sm focus:ring-2 focus:ring-cyan-500 transition-all"
                                                    min="0"
                                                />
                                            </div>
                                        )}
                                    </div>

                                    {/* Round 11 */}
                                    <div className="mb-4">
                                        <label className="flex items-center gap-3 mb-3 cursor-pointer group">
                                            <input 
                                                type="checkbox" 
                                                checked={round11Enabled}
                                                onChange={(e) => setRound11Enabled(e.target.checked)}
                                                className="w-5 h-5 accent-purple-500"
                                            />
                                            <span className="font-semibold text-lg group-hover:text-purple-400 transition-colors">Round 11+ (Epic Add Picks)</span>
                                        </label>
                                        {round11Enabled && (
                                            <div className="ml-8">
                                                <label className="block text-sm text-gray-400 mb-1">Add picks (2‚òÖ-max)</label>
                                                <input 
                                                    type="number"
                                                    value={round11AddPicks}
                                                    onChange={(e) => setRound11AddPicks(Math.max(0, parseInt(e.target.value) || 0))}
                                                    className="w-full bg-slate-900/50 border border-slate-600/50 rounded-xl px-3 py-2 text-sm focus:ring-2 focus:ring-purple-500 transition-all"
                                                    min="0"
                                                />
                                            </div>
                                        )}
                                    </div>
                                </div>

                                {/* Portal Regionals */}
                                <div className="bg-gradient-to-br from-slate-800/80 to-slate-900/80 backdrop-blur-xl rounded-3xl p-8 border border-slate-700/50 shadow-2xl">
                                    <div className="flex items-center gap-3 mb-4">
                                        <div className="w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-xl">
                                            üåÄ
                                        </div>
                                        <h2 className="text-2xl font-bold">Portal-Specific Regionals</h2>
                                    </div>
                                    <div className="mb-6 p-3 bg-amber-900/30 border border-amber-500/50 rounded-xl">
                                        <div className="text-amber-400 font-semibold text-sm flex items-center gap-2">
                                            <span>‚ö†Ô∏è</span>
                                            <span>DO NOT PUT WILD UNITS HERE - Use Wild Mechanics section below</span>
                                        </div>
                                    </div>
                                    <div className="space-y-3">
                                        {Object.keys(portalRegionals).map(rarity => (
                                            <div key={rarity} className="grid grid-cols-3 gap-3 items-center p-3 bg-slate-900/30 rounded-2xl">
                                                <span className={`capitalize font-semibold ${rarityColors[rarity]}`}>
                                                    {rarity}
                                                </span>
                                                <div>
                                                    <label className="block text-xs text-gray-400 mb-1">2‚òÖ-max</label>
                                                    <input 
                                                        type="number"
                                                        value={portalRegionals[rarity].twoStar}
                                                        onChange={(e) => updatePortalRegional(rarity, 'twoStar', e.target.value)}
                                                        className="w-full bg-slate-900/50 border border-slate-600/50 rounded-xl px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 transition-all"
                                                        min="0"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-xs text-gray-400 mb-1">3‚òÖ-max</label>
                                                    <input 
                                                        type="number"
                                                        value={portalRegionals[rarity].threeStar}
                                                        onChange={(e) => updatePortalRegional(rarity, 'threeStar', e.target.value)}
                                                        className="w-full bg-slate-900/50 border border-slate-600/50 rounded-xl px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 transition-all"
                                                        min="0"
                                                    />
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* Wild Mechanics - Collapsible */}
                                <div className="bg-gradient-to-br from-amber-900/50 to-yellow-900/50 backdrop-blur-xl rounded-3xl p-8 border border-amber-500/30 shadow-2xl">
                                    <button
                                        onClick={() => setWildExpanded(!wildExpanded)}
                                        className="w-full flex items-center justify-between mb-6 group"
                                    >
                                        <div className="flex items-center gap-3">
                                            <div className="w-10 h-10 rounded-full bg-gradient-to-br from-amber-500 to-yellow-500 flex items-center justify-center text-xl">
                                                üåø
                                            </div>
                                            <h2 className="text-2xl font-bold">Wild Mechanics</h2>
                                        </div>
                                        <ChevronDown className={`w-6 h-6 transition-transform duration-200 ${wildExpanded ? 'rotate-180' : ''}`} />
                                    </button>

                                    {wildExpanded && (
                                        <div className="space-y-6">
                                            {/* Wild Controls */}
                                            <div className="grid grid-cols-2 gap-4 mb-6">
                                                <label className="flex items-center gap-3 cursor-pointer px-4 py-3 bg-slate-900/30 rounded-2xl border border-slate-600/30 hover:border-amber-500/50 transition-all">
                                                    <input 
                                                        type="checkbox"
                                                        checked={targetIsWild}
                                                        onChange={(e) => setTargetIsWild(e.target.checked)}
                                                        className="w-5 h-5 accent-amber-500"
                                                    />
                                                    <div>
                                                        <span className="font-semibold text-amber-400">Target is Wild</span>
                                                        <div className="text-xs text-gray-400">Dual-path calculation</div>
                                                    </div>
                                                </label>

                                                <label className="flex items-center gap-3 cursor-pointer px-4 py-3 bg-slate-900/30 rounded-2xl border border-slate-600/30 hover:border-amber-500/50 transition-all">
                                                    <input 
                                                        type="checkbox"
                                                        checked={pveRoundEnabled}
                                                        onChange={(e) => setPveRoundEnabled(e.target.checked)}
                                                        className="w-5 h-5 accent-amber-500"
                                                    />
                                                    <div>
                                                        <span className="font-semibold text-amber-400">PvE Round</span>
                                                        <div className="text-xs text-gray-400">+5% base boost</div>
                                                    </div>
                                                </label>
                                            </div>

                                            <div>
                                                <label className="block text-sm font-semibold mb-2 text-gray-300">Wild Units Owned</label>
                                                <input 
                                                    type="number"
                                                    value={wildUnitsOwned}
                                                    onChange={(e) => setWildUnitsOwned(Math.max(0, parseInt(e.target.value) || 0))}
                                                    className="w-full bg-slate-900/50 border border-slate-600/50 rounded-2xl px-4 py-3 focus:ring-2 focus:ring-amber-500 focus:border-transparent transition-all"
                                                    min="0"
                                                />
                                                <div className="text-xs text-amber-400 mt-2">
                                                    +1% boost per unit
                                                    {pveRoundEnabled && targetIsWild && (
                                                        <span className="ml-2 font-bold">
                                                            (Total: +{probabilities.wildBoost.toFixed(1)}%)
                                                        </span>
                                                    )}
                                                </div>
                                            </div>

                                            {/* Wild-Specific Scouting (only shown when Target is Wild) */}
                                            {targetIsWild && (
                                                <div className="border-t border-amber-700/30 pt-6">
                                                    <h3 className="font-bold text-lg mb-4 text-amber-300 flex items-center gap-2">
                                                        <span>üîç</span>
                                                        <span>Wild Scouting</span>
                                                    </h3>
                                                    <p className="text-sm text-gray-400 mb-4">
                                                        Track Wild units separately (same rarity/evo as your target)
                                                    </p>
                                                    <div className="grid grid-cols-2 gap-4">
                                                        <div>
                                                            <label className="block text-sm font-semibold mb-2 text-gray-300">Wild Units Taken (Opponents)</label>
                                                            <input 
                                                                type="number"
                                                                value={wildUnitsTaken}
                                                                onChange={(e) => setWildUnitsTaken(Math.max(0, parseInt(e.target.value) || 0))}
                                                                className="w-full bg-slate-900/50 border border-slate-600/50 rounded-2xl px-4 py-3 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                                                                min="0"
                                                            />
                                                            <div className="text-xs text-gray-400 mt-2">
                                                                Reduces Wild pool for Path A
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <label className="block text-sm font-semibold mb-2 text-gray-300">Wild Units Benched (Yours)</label>
                                                            <input 
                                                                type="number"
                                                                value={wildUnitsBenched}
                                                                onChange={(e) => setWildUnitsBenched(Math.max(0, parseInt(e.target.value) || 0))}
                                                                className="w-full bg-slate-900/50 border border-slate-600/50 rounded-2xl px-4 py-3 focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all"
                                                                min="0"
                                                            />
                                                            <div className="text-xs text-gray-400 mt-2">
                                                                Reduces Wild pool for Path A
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            )}

                                            {/* Base Wild Counts */}
                                            <div className="border-t border-amber-700/30 pt-6">
                                                <h3 className="font-bold text-lg mb-4 text-amber-300">Base Wild Counts</h3>
                                                <div className="grid grid-cols-2 gap-3">
                                                    <div className="p-3 bg-slate-900/30 rounded-xl">
                                                        <div className="text-gray-400 text-sm">Common</div>
                                                        <div className="font-bold">2 (2‚òÖ-max)</div>
                                                    </div>
                                                    <div className="p-3 bg-slate-900/30 rounded-xl">
                                                        <div className="text-green-400 text-sm">Uncommon</div>
                                                        <div className="font-bold">4 (2‚òÖ-max)</div>
                                                    </div>
                                                    <div className="p-3 bg-slate-900/30 rounded-xl">
                                                        <div className="text-cyan-400 text-sm">Rare</div>
                                                        <div className="font-bold">4 (2‚òÖ-max)</div>
                                                    </div>
                                                    <div className="p-3 bg-slate-900/30 rounded-xl">
                                                        <div className="text-purple-400 text-sm">Epic</div>
                                                        <div className="font-bold">3 (1√ó3‚òÖ, 2√ó2‚òÖ)</div>
                                                    </div>
                                                    <div className="p-3 bg-slate-900/30 rounded-xl col-span-2">
                                                        <div className="text-red-400 text-sm">Ultra</div>
                                                        <div className="font-bold">1 (3‚òÖ-max)</div>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Add Pick Wild Additions */}
                                            <div className="border-t border-amber-700/30 pt-6">
                                                <h3 className="font-bold text-lg mb-4 text-amber-300">Add Pick Wild Additions</h3>
                                                <div className="space-y-3">
                                                    {round5Enabled && (
                                                        <div>
                                                            <label className="block text-sm text-gray-400 mb-1">Round 5+ Uncommon Wilds (2‚òÖ-max)</label>
                                                            <input 
                                                                type="number"
                                                                value={wildAddPicks.uncommon}
                                                                onChange={(e) => setWildAddPicks(prev => ({ ...prev, uncommon: Math.max(0, parseInt(e.target.value) || 0) }))}
                                                                className="w-full bg-slate-900/50 border border-slate-600/50 rounded-xl px-3 py-2 text-sm focus:ring-2 focus:ring-green-500 transition-all"
                                                                min="0"
                                                            />
                                                        </div>
                                                    )}
                                                    {round8Enabled && (
                                                        <div>
                                                            <label className="block text-sm text-gray-400 mb-1">Round 8+ Rare Wilds (2‚òÖ-max)</label>
                                                            <input 
                                                                type="number"
                                                                value={wildAddPicks.rare}
                                                                onChange={(e) => setWildAddPicks(prev => ({ ...prev, rare: Math.max(0, parseInt(e.target.value) || 0) }))}
                                                                className="w-full bg-slate-900/50 border border-slate-600/50 rounded-xl px-3 py-2 text-sm focus:ring-2 focus:ring-cyan-500 transition-all"
                                                                min="0"
                                                            />
                                                        </div>
                                                    )}
                                                    {round11Enabled && (
                                                        <div>
                                                            <label className="block text-sm text-gray-400 mb-1">Round 11+ Epic Wilds (2‚òÖ-max)</label>
                                                            <input 
                                                                type="number"
                                                                value={wildAddPicks.epic}
                                                                onChange={(e) => setWildAddPicks(prev => ({ ...prev, epic: Math.max(0, parseInt(e.target.value) || 0) }))}
                                                                className="w-full bg-slate-900/50 border border-slate-600/50 rounded-xl px-3 py-2 text-sm focus:ring-2 focus:ring-purple-500 transition-all"
                                                                min="0"
                                                            />
                                                        </div>
                                                    )}
                                                    {!round5Enabled && !round8Enabled && !round11Enabled && (
                                                        <div className="text-sm text-gray-500 italic">
                                                            Enable add pick rounds to configure Wild additions
                                                        </div>
                                                    )}
                                                </div>
                                            </div>

                                            {/* Regional Wild Additions */}
                                            <div className="border-t border-amber-700/30 pt-6">
                                                <h3 className="font-bold text-lg mb-4 text-amber-300">Regional Wild Additions</h3>
                                                <div className="space-y-3">
                                                    {Object.keys(wildRegionals).map(rarity => (
                                                        <div key={rarity} className="grid grid-cols-3 gap-3 items-center p-3 bg-slate-900/30 rounded-2xl">
                                                            <span className={`capitalize font-semibold ${rarityColors[rarity]}`}>
                                                                {rarity}
                                                            </span>
                                                            <div>
                                                                <label className="block text-xs text-gray-400 mb-1">2‚òÖ-max</label>
                                                                <input 
                                                                    type="number"
                                                                    value={wildRegionals[rarity].twoStar}
                                                                    onChange={(e) => updateWildRegional(rarity, 'twoStar', e.target.value)}
                                                                    className="w-full bg-slate-900/50 border border-slate-600/50 rounded-xl px-3 py-2 text-sm focus:ring-2 focus:ring-amber-500 transition-all"
                                                                    min="0"
                                                                />
                                                            </div>
                                                            <div>
                                                                <label className="block text-xs text-gray-400 mb-1">3‚òÖ-max</label>
                                                                <input 
                                                                    type="number"
                                                                    value={wildRegionals[rarity].threeStar}
                                                                    onChange={(e) => updateWildRegional(rarity, 'threeStar', e.target.value)}
                                                                    className="w-full bg-slate-900/50 border border-slate-600/50 rounded-xl px-3 py-2 text-sm focus:ring-2 focus:ring-amber-500 transition-all"
                                                                    min="0"
                                                                />
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* Right Column - Results */}
                            <div className="space-y-6">
                                {/* Main Probabilities Card */}
                                <div className="bg-gradient-to-br from-cyan-900/50 to-blue-900/50 backdrop-blur-xl rounded-3xl p-6 border border-cyan-500/30 shadow-2xl">
                                    <div className="flex items-center gap-2 mb-6">
                                        <div className="w-8 h-8 rounded-full bg-gradient-to-br from-cyan-400 to-blue-500 flex items-center justify-center">
                                            <TrendingUp className="w-5 h-5 text-white" />
                                        </div>
                                        <h2 className="text-xl font-bold">Probabilities</h2>
                                    </div>

                                    <div className="space-y-4">
                                        <div className="bg-black/30 backdrop-blur-sm rounded-2xl p-4 border border-cyan-500/20">
                                            <div className="text-sm text-gray-400 mb-1">Per Slot (Target Only)</div>
                                            <div className={`text-3xl font-bold ${probabilities.targetCopies === 0 ? 'text-red-400' : probabilities.wildTargetImpossible ? 'text-red-400' : 'text-cyan-400'}`}>
                                                {probabilities.perSlot === 0 ? '0.000' : probabilities.perSlot < 0.001 ? '<0.001' : probabilities.perSlot.toFixed(3)}%
                                            </div>
                                            {probabilities.wildTargetImpossible && (
                                                <div className="text-xs text-red-400 mt-2 font-semibold flex items-center gap-1">
                                                    <span>‚ùå</span>
                                                    <span>No Wild {targetRarity} {targetEvo === 'twoStar' ? '2‚òÖ' : '3‚òÖ'}-max units exist!</span>
                                                </div>
                                            )}
                                            {!probabilities.wildTargetImpossible && probabilities.targetCopies === 0 && (
                                                <div className="text-xs text-red-400 mt-1 font-semibold">‚ùå Pool depleted!</div>
                                            )}
                                            {!probabilities.wildTargetImpossible && pveRoundEnabled && targetIsWild && probabilities.wildBoost > 0 && probabilities.targetCopies > 0 && (
                                                <div className="text-xs text-amber-400 mt-1 font-semibold">
                                                    üåø +{probabilities.wildBoost.toFixed(1)}% Wild boost active
                                                </div>
                                            )}
                                            {!probabilities.wildTargetImpossible && pveRoundEnabled && !targetIsWild && probabilities.wildBoost > 0 && (
                                                <div className="text-xs text-orange-400 mt-1 font-semibold">
                                                    ‚ö†Ô∏è -{probabilities.wildBoost.toFixed(1)}% (Wild penalty)
                                                </div>
                                            )}
                                        </div>

                                        <div className="bg-black/30 backdrop-blur-sm rounded-2xl p-4 border border-blue-500/20">
                                            <div className="text-sm text-gray-400 mb-2">Per Refresh (6 slots)</div>
                                            <div className="space-y-2">
                                                <div className="flex justify-between items-center">
                                                    <span className="text-xs text-gray-400">Without Ditto:</span>
                                                    <span className="text-xl font-bold text-blue-400">
                                                        {probabilities.perRefresh === 0 ? '0.00' : probabilities.perRefresh < 0.01 ? '<0.01' : probabilities.perRefresh.toFixed(2)}%
                                                    </span>
                                                </div>
                                                <div className="flex justify-between items-center">
                                                    <span className="text-xs text-gray-400">With Ditto:</span>
                                                    <span className={`text-xl font-bold ${dittoEnabled ? 'text-green-400' : 'text-gray-600'}`}>
                                                        {probabilities.perRefreshWithDitto === 0 ? '0.00' : probabilities.perRefreshWithDitto < 0.01 ? '<0.01' : probabilities.perRefreshWithDitto.toFixed(2)}%
                                                    </span>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="bg-black/30 backdrop-blur-sm rounded-2xl p-4 border border-green-500/20">
                                            <div className="text-sm text-gray-400 mb-1">
                                                Over {refreshes} Refreshes
                                            </div>
                                            <div className="text-4xl font-bold text-green-400">
                                                {probabilities.overNRefreshes === 0 ? '0.00' : probabilities.overNRefreshes < 0.01 ? '<0.01' : probabilities.overNRefreshes.toFixed(2)}%
                                            </div>
                                            {dittoEnabled && (
                                                <div className="text-xs text-green-400 mt-1 font-semibold">‚úì Ditto included</div>
                                            )}
                                        </div>
                                    </div>
                                </div>

                                {/* Expected Refreshes */}
                                <div className="bg-gradient-to-br from-slate-800/80 to-slate-900/80 backdrop-blur-xl rounded-3xl p-6 border border-slate-700/50 shadow-2xl">
                                    <h3 className="font-bold text-lg mb-4">Expected Refreshes</h3>
                                    {probabilities.wildTargetImpossible ? (
                                        <div className="text-sm text-red-400 font-semibold">
                                            ‚ùå No Wild {targetRarity} {targetEvo === 'twoStar' ? '2‚òÖ' : '3‚òÖ'}-max units exist
                                        </div>
                                    ) : probabilities.targetCopies > 0 ? (
                                        <div className="space-y-3">
                                            <div className="flex justify-between items-center p-3 bg-slate-900/50 rounded-xl">
                                                <span className="text-gray-400">50% chance:</span>
                                                <span className="font-bold text-lg">{probabilities.expectedFor50} refreshes</span>
                                            </div>
                                            <div className="flex justify-between items-center p-3 bg-slate-900/50 rounded-xl">
                                                <span className="text-gray-400">75% chance:</span>
                                                <span className="font-bold text-lg">{probabilities.expectedFor75} refreshes</span>
                                            </div>
                                            <div className="flex justify-between items-center p-3 bg-slate-900/50 rounded-xl">
                                                <span className="text-gray-400">90% chance:</span>
                                                <span className="font-bold text-lg">{probabilities.expectedFor90} refreshes</span>
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="text-sm text-red-400 font-semibold">
                                            ‚ùå No copies remaining in pool
                                        </div>
                                    )}
                                </div>

                                {/* Gold Cost */}
                                <div className="bg-gradient-to-br from-yellow-900/50 to-orange-900/50 backdrop-blur-xl rounded-3xl p-6 border border-yellow-500/30 shadow-2xl">
                                    <h3 className="font-bold text-lg mb-4 flex items-center gap-2">
                                        <span className="text-2xl">üí∞</span>
                                        Gold Cost to {evolutionGoal === 'firstEvo' ? '2‚òÖ' : '3‚òÖ'}
                                    </h3>
                                    {probabilities.wildTargetImpossible ? (
                                        <div className="text-sm text-red-400 font-semibold">
                                            ‚ùå No Wild {targetRarity} {targetEvo === 'twoStar' ? '2‚òÖ' : '3‚òÖ'}-max units exist
                                        </div>
                                    ) : probabilities.copiesStillNeeded === 0 ? (
                                        <div className="text-sm text-green-400 font-semibold">
                                            ‚úì You already have all copies needed!
                                        </div>
                                    ) : probabilities.targetCopies >= probabilities.copiesStillNeeded ? (
                                        <div className="space-y-3">
                                            <div className="flex justify-between items-center p-3 bg-black/30 rounded-xl">
                                                <span className="text-gray-400">~50% chance:</span>
                                                <span className="font-bold text-xl text-yellow-400">{probabilities.goldFor50}g</span>
                                            </div>
                                            <div className="flex justify-between items-center p-3 bg-black/30 rounded-xl">
                                                <span className="text-gray-400">~75% chance:</span>
                                                <span className="font-bold text-xl text-yellow-400">{probabilities.goldFor75}g</span>
                                            </div>
                                            <div className="flex justify-between items-center p-3 bg-black/30 rounded-xl">
                                                <span className="text-gray-400">~90% chance:</span>
                                                <span className="font-bold text-xl text-yellow-400">{probabilities.goldFor90}g</span>
                                            </div>
                                            <div className="text-xs text-gray-400 mt-2 text-center">
                                                {evolutionGoal === 'firstEvo' ? 'First evolution (2‚òÖ)' : 'Max evolution (3‚òÖ)'}
                                                {copiesOwned > 0 && ` ‚Ä¢ ${copiesOwned}/${probabilities.totalCopiesNeeded} owned`}
                                                {probabilities.copiesStillNeeded > 0 && ` ‚Ä¢ ${probabilities.copiesStillNeeded} more needed`}
                                                {dittoEnabled && ' ‚Ä¢ Ditto included'}
                                                {pveRoundEnabled && targetIsWild && ' ‚Ä¢ Wild boost'}
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="text-sm text-red-400 font-semibold">
                                            ‚ùå Insufficient copies ({probabilities.targetCopies}/{probabilities.copiesStillNeeded})
                                        </div>
                                    )}
                                </div>

                                {/* Level Up Preview */}
                                {probabilities.levelUpPreview && (
                                    <div className="bg-gradient-to-br from-blue-900/50 to-indigo-900/50 backdrop-blur-xl rounded-3xl p-6 border border-blue-500/30 shadow-2xl">
                                        <h3 className="font-bold text-lg mb-4">Level {probabilities.levelUpPreview.nextLevel} Preview</h3>
                                        <div className="space-y-3">
                                            <div className="flex justify-between items-center p-3 bg-black/30 rounded-xl">
                                                <span className="text-gray-400">Per refresh:</span>
                                                <span className="font-bold text-lg text-blue-400">
                                                    {probabilities.levelUpPreview.perRefresh === 0 ? '0.00' : probabilities.levelUpPreview.perRefresh < 0.01 ? '<0.01' : probabilities.levelUpPreview.perRefresh.toFixed(2)}%
                                                </span>
                                            </div>
                                            <div className="flex justify-between items-center p-3 bg-black/30 rounded-xl">
                                                <span className="text-gray-400">Improvement:</span>
                                                <span className={`font-bold text-lg ${
                                                    probabilities.levelUpPreview.improvementPercent > 0 ? 'text-green-400' : 'text-red-400'
                                                }`}>
                                                    {probabilities.levelUpPreview.improvementPercent > 0 ? '+' : ''}
                                                    {probabilities.levelUpPreview.improvementPercent.toFixed(1)}%
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* Pool Info */}
                                <div className="bg-gradient-to-br from-slate-800/80 to-slate-900/80 backdrop-blur-xl rounded-3xl p-6 border border-slate-700/50 shadow-2xl">
                                    <h3 className="font-bold text-lg mb-4">Pool Info</h3>
                                    <div className="space-y-3">
                                        <div className="flex justify-between items-center p-3 bg-slate-900/50 rounded-xl">
                                            <span className="text-gray-400">Target remaining:</span>
                                            <span className="font-bold">{probabilities.targetCopies} / {probabilities.maxTargetCopies}</span>
                                        </div>
                                        {benchUnits > 0 && (
                                            <div className="flex justify-between items-center p-3 bg-slate-900/50 rounded-xl text-sm">
                                                <span className="text-gray-500">Bench effect:</span>
                                                <span className="text-gray-500">-{benchUnits} from pool</span>
                                            </div>
                                        )}
                                        <div className="flex justify-between items-center p-3 bg-slate-900/50 rounded-xl">
                                            <span className="text-gray-400 capitalize">Total {targetRarity}:</span>
                                            <span className="font-bold">{probabilities.totalPoolSize}</span>
                                        </div>
                                        <div className="flex justify-between items-center p-3 bg-slate-900/50 rounded-xl">
                                            <span className="text-gray-400 capitalize">{targetRarity} rate:</span>
                                            <span className="font-bold">{probabilities.rarityChance.toFixed(0)}%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="mt-12 text-center">
                            <div className="inline-block px-6 py-3 bg-slate-900/50 backdrop-blur-sm rounded-full border border-slate-700/50">
                                <p className="text-sm text-gray-400">
                                    Pool calculation with Wild mechanics ‚Ä¢ PvE boost system ‚Ä¢ 6 slots per refresh
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<PokemonAutoChessCalculator />, document.getElementById('root'));
    </script>
    
    <!-- Feature Loader: Dynamically loads external feature files -->
    <script>
        (function() {
            // List of optional feature files to load
            // Add new features here without modifying anything else
            const features = [
                { src: 'analytics.js', type: 'text/javascript', required: false }
                // Add more features: { src: 'feature-name.js', type: 'text/javascript', required: false }
            ];
            
            // Load features after a short delay to ensure calculator is ready
            setTimeout(() => {
                features.forEach(feature => {
                    const script = document.createElement('script');
                    script.src = feature.src;
                    script.type = feature.type || 'text/javascript';
                    
                    script.onload = () => {
                        console.log(`‚úì Feature loaded: ${feature.src}`);
                    };
                    
                    script.onerror = () => {
                        if (feature.required) {
                            console.error(`‚úó Required feature failed to load: ${feature.src}`);
                        } else {
                            console.log(`‚óã Optional feature not available: ${feature.src}`);
                        }
                    };
                    
                    document.body.appendChild(script);
                });
            }, 100);
            
            // Helper function to load features dynamically at runtime
            window.loadFeature = function(src, type = 'text/javascript') {
                return new Promise((resolve, reject) => {
                    const script = document.createElement('script');
                    script.src = src;
                    script.type = type;
                    script.onload = resolve;
                    script.onerror = reject;
                    document.body.appendChild(script);
                });
            };
            
            // Expose utility functions for analytics
            window.analyticsUtils = {
                // Calculate probability curve data points
                getProbabilityCurve: function(maxRefreshes = 100) {
                    const state = window.calculatorState;
                    if (!state || !state.probabilities) return [];
                    
                    const perRefreshProb = state.dittoEnabled ? 
                        state.probabilities.perRefreshWithDitto / 100 : 
                        state.probabilities.perRefresh / 100;
                    
                    const data = [];
                    for (let r = 1; r <= maxRefreshes; r++) {
                        const cumulative = 1 - Math.pow(1 - perRefreshProb, r);
                        data.push({
                            refreshes: r,
                            gold: r * 2,
                            probability: cumulative * 100,
                            expectedCopies: r * 6 * (state.probabilities.perSlot / 100)
                        });
                    }
                    return data;
                },
                
                // Calculate level comparison data
                getLevelComparison: function() {
                    const state = window.calculatorState;
                    if (!state) return [];
                    
                    const data = [];
                    for (let lvl = 1; lvl <= 9; lvl++) {
                        const rarityChance = state.shopOdds[lvl][state.targetRarity] / 100;
                        const pool = state.calculateTotalPool[state.targetRarity];
                        const poolSize = state.targetEvo === 'twoStar' ? pool.twoStarTotal : pool.threeStarTotal;
                        const otherPool = state.targetEvo === 'twoStar' ? pool.threeStarTotal : pool.twoStarTotal;
                        const totalPool = poolSize + otherPool - state.benchUnits;
                        const targetCopies = state.probabilities.targetCopies;
                        
                        const perSlot = totalPool > 0 ? rarityChance * (targetCopies / totalPool) : 0;
                        const perRefresh = 1 - Math.pow(1 - perSlot, 6);
                        
                        data.push({
                            level: lvl,
                            rarityChance: rarityChance * 100,
                            perSlot: perSlot * 100,
                            perRefresh: perRefresh * 100
                        });
                    }
                    return data;
                },
                
                // Calculate sensitivity data for tornado chart
                getSensitivityData: function() {
                    const state = window.calculatorState;
                    if (!state || !state.probabilities) return [];
                    
                    const baseProb = state.probabilities.perRefresh;
                    if (baseProb === 0) return [];
                    
                    const factors = [];
                    
                    // Level impact (+1 level)
                    if (state.level < 9) {
                        const levelData = this.getLevelComparison();
                        const nextLevelProb = levelData[state.level]?.perRefresh || 0;
                        const impact = nextLevelProb - baseProb;
                        if (Math.abs(impact) > 0.01) {
                            factors.push({
                                name: 'Level +1',
                                impact: impact,
                                type: impact >= 0 ? 'positive' : 'negative'
                            });
                        }
                    }
                    
                    // Ditto impact
                    const dittoImpact = state.probabilities.perRefreshWithDitto - state.probabilities.perRefresh;
                    factors.push({
                        name: 'Include Ditto',
                        impact: dittoImpact,
                        type: 'positive'
                    });
                    
                    // Copies taken impact (simulate having 3 less copies taken)
                    if (state.copiesTaken > 0) {
                        const impactPerCopy = baseProb * 0.08; // ~8% reduction per copy taken
                        factors.push({
                            name: `Scouted Units (-${state.copiesTaken})`,
                            impact: -state.copiesTaken * impactPerCopy,
                            type: 'negative'
                        });
                    }
                    
                    // Wild boost impact (if PVE)
                    if (state.pveRoundEnabled && state.targetIsWild) {
                        factors.push({
                            name: 'PvE Wild Boost',
                            impact: state.probabilities.wildBoost * 0.4,
                            type: 'positive'
                        });
                    } else if (state.pveRoundEnabled && !state.targetIsWild) {
                        factors.push({
                            name: 'PvE Wild Penalty',
                            impact: -state.probabilities.wildBoost * 0.25,
                            type: 'negative'
                        });
                    }
                    
                    // Bench impact (removing units from pool helps you)
                    if (state.benchUnits > 0) {
                        const impactPerBench = baseProb * 0.03;
                        factors.push({
                            name: `Bench Units (+${state.benchUnits})`,
                            impact: state.benchUnits * impactPerBench,
                            type: 'positive'
                        });
                    }
                    
                    // Pool dilution from add picks
                    const totalAddPicks = (state.round5Enabled ? state.round5AddPicks : 0) +
                                         (state.round8Enabled ? state.round8AddPicks : 0) +
                                         (state.round11Enabled ? state.round11AddPicks : 0);
                    if (totalAddPicks > 0) {
                        factors.push({
                            name: `Pool Dilution (${totalAddPicks} adds)`,
                            impact: -totalAddPicks * baseProb * 0.02,
                            type: 'negative'
                        });
                    }
                    
                    // Sort by absolute impact
                    return factors.sort((a, b) => Math.abs(b.impact) - Math.abs(a.impact));
                },
                
                // Calculate gold ROI data
                getGoldROI: function(maxGold = 200) {
                    const state = window.calculatorState;
                    if (!state || !state.probabilities) return [];
                    
                    const perRefreshProb = state.dittoEnabled ?
                        state.probabilities.perRefreshWithDitto / 100 :
                        state.probabilities.perRefresh / 100;
                    
                    const perSlotProb = state.dittoEnabled ?
                        state.probabilities.perSlotWithDitto / 100 :
                        state.probabilities.perSlot / 100;
                    
                    const data = [];
                    for (let gold = 2; gold <= maxGold; gold += 2) {
                        const refreshes = gold / 2;
                        const cumulative = 1 - Math.pow(1 - perRefreshProb, refreshes);
                        const expectedCopies = refreshes * 6 * perSlotProb;
                        
                        data.push({
                            gold: gold,
                            refreshes: refreshes,
                            probability: cumulative * 100,
                            expectedCopies: expectedCopies,
                            copiesNeeded: state.probabilities.copiesStillNeeded,
                            efficiency: expectedCopies / gold // copies per gold
                        });
                    }
                    return data;
                }
            };
            
            console.log('üìä PAC Analytics Framework initialized');
            console.log('   ‚Üí Calculator state exposed at window.calculatorState');
            console.log('   ‚Üí Analytics utilities at window.analyticsUtils');
            console.log('   ‚Üí Listen for "calculatorStateChange" events');
        })();
    </script>
</body>
</html>
